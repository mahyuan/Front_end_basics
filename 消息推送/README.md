# 消息推送

目前主流的消息推送方式有短连接轮询，长轮询，websocket，SSE

## 短连接轮询

前端用定时器setTimeout或setInterval，每隔一段时间发送请求获取最新消息
优点：
- 兼容性很好
- 获取的消息顺序有保证

缺点：
- 页面会“假死”
由于eventlop机制，宏事件执行被滞后时，获取数据会滞后
- 频繁的网络请求
客户端固定频率发请求，数据没更新时，浪费服务器资源

## 长轮询

长轮询即长连接， 客户端请求后服务端保持长连接，不会立即返回，直到有数据了才返回数据，然后关闭连接，客户端处理完成后再次发起请求。

优点：
- 长轮询解决了频繁的网络请求资源浪费，有数据了可以及时返回浏览器

缺点：
- 保持长连接消耗资源
- 服务器没有数据时，请求超时

## iframe流

在页面嵌入一个隐藏的iframe, 利用其src属性在服务器和客户端之间创建一个长连接，服务器想iframe传输资源（通常是html,内有负责插入信息的javascript），来实时更新页面

前端实现：
iframe设置为不显示，src设为数据地址，定义父级函数用户让iframe子页面传数据给父页面，定义onload事件服务器timeout后再次重新加载iframe


优点：
iffame流方式浏览器兼容性好

缺点：
iE, firefox会显示没有加载完成，loading状态
服务器维护长连接消耗


## websocket

http请求增加Upgrade: websocket及通信秘钥 Sec-WebSocket-Key，双方握手成功，建立双工通信

websocket是事件驱动，消息和事件异步到达

## Server-Sent Events (SSE)

与长轮询机制类似，区别是每个连接不会只发送一个消息。服务器响应后，连接还会持续，由服务器单向发送消息给客户端。

SEE本质发送的不是一次性的数据包，而是一个数据流，可以使用http 301和307重定向与正常的http请求一样。服务器连续不断的发送，客户端不会关闭连接，如果连接断开，浏览器会尝试重新连接。

SSE 只适用于高级浏览器，ie不支持


https://zhuanlan.zhihu.com/p/31297574
